<section id="search-publications">
  <div class="container-fluid">
    <% @model.each do |row| %>
      <div class="row d-flex justify-content-center" style="margin-bottom: 20px;">
        <div class="col-8" style="border: 1px solid red;">

          <div class="row">
            <div class="col-12">
              <p><%= row.title %></p>
            </div>
          </div>

          <div class="row">
            <div class="col-md-8">
              <textarea name="name" rows="8" style="width: 100%;" disabled><%= strip_tags(row.information)%></textarea>
            </div>
            <div class="col-md-4">
              <% if row.location.present? %>
                <div id="map" style="height: 200px; width: 100%; border: 2px solid #CFD8DC;"></div>
              <% end %>
            </div>
          </div>

        </div>
      </div>

      <script src='https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_KEY'] %>'></script>
         <script type='text/javascript'>

          function initialize() {

            navigator.geolocation.getCurrentPosition(function(location) {
              var lat = location.coords.latitude;
              var lng = location.coords.longitude;

              "<% if row.location.present? %>"
                var my_position = new google.maps.LatLng(<%= row.place_pin %>);
              "<% else %>"
                var my_position = new google.maps.LatLng(lat,lng);
                var input = document.getElementById('input_id');
                input.value =  lat + ", " + lng;
              "<% end %>"

              var map = new google.maps.Map(document.getElementById('map'), {
                  center: my_position,
                  zoom: 15
              });
              var marker = new google.maps.Marker({
                  position: my_position,
                  map: map
              });

            });

          }
          google.maps.event.addDomListener(window, 'load', initialize);
       </script>

    <% end %>
  </div>
</section>
